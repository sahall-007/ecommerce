<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Shopping Cart</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <link
        href="https://fonts.googleapis.com/css2?family=Titillium+Web:ital,wght@0,200;0,300;0,400;0,600;0,700;0,900;1,200;1,300;1,400;1,600;1,700&display=swap"
        rel="stylesheet">
    <style>
        html,
        body {
            height: 100%;
            /* background: #f1f4f9; */
            font-family: "Titillium Web", sans-serif;
        }

        body {
            display: flex;
             min-height: 100vh;
            flex-direction: column;
        }

        .main-content {
            flex: 1 0 auto;
        }

        footer {
            flex-shrink: 0;
        }

        .cart-item {
            border-bottom: 1px solid #eee;
            padding: 1.5rem 0;
        }

        .cart-item:last-child {
            border-bottom: none;
        }

        .quantity-btn {
            /* width: 36px; */
            /* height: 36px; */
            /* display: flex; */
            /* align-items: center; */
            /* justify-content: center; */
            /* font-size: 1.2rem; */
            /* user-select: none; */
            cursor: pointer;
        }

        /* .quantity-input {
            width: 50px;
            text-align: center;
            border: 1px solid #ddd;
            border-radius: 0.375rem;
        } */

        /* .subtotal-price {
            font-weight: 600;
            color: #212529;
        }

        .total-price {
            font-size: 1.5rem;
            font-weight: 700;
        } */

        .btn-proceed {
            background-color: #ff6d00;
            border: none;
            padding: 0.75rem 2rem;
            font-weight: 600;
        }

        .btn-proceed:hover {
            background-color: #e65c00;
        }

        @media (max-width: 576px) {

            .table th,
            .table td {
                font-size: 0.9rem;
            }

            /* .quantity-btn {
                width: 32px;
                height: 32px;
                font-size: 1rem;
            } */
/* 
            .quantity-input {
                width: 40px;
            } */
        }

        .navbar {
            padding: 0.8rem 1rem;
        }

        .navbar-brand {
            font-weight: bold;
            font-size: 1.5rem;
        }

        .navbar .form-control {
            width: 220px;
            border-radius: 0.375rem 0 0 0.375rem;
        }

        .navbar .btn-outline-secondary {
            border-radius: 0 0.375rem 0.375rem 0;
        }

        .nav-link:hover {
            color: #0d6efd !important;
        }

        @media (max-width: 992px) {
            .sidebar {
                position: relative;
                width: 100%;
                height: auto;
                box-shadow: none;
            }

            .content {
                margin-left: 0;
            }
        }

        .sidebar {
            /* width: 250px; */
            /* flex-shrink: 0; */
            background: #fff;
            /* height: 100vh; */
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
            /* position: fixed;
            left: 0;
            top: 0;
            padding-top: 20px; */
        }
        .sidebar a {
            display: block;
            padding: 12px 20px;
            font-size: 15px;
            color: #333;
            text-decoration: none;
        }
        .sidebar a:hover {
            background: #f0f3f7;
        }
    </style>
</head>

<body class="bg-light">

    <!-- ==================== NAVBAR ==================== -->
    <nav class="navbar navbar-expand-lg bg-black shadow-sm">
        <div class="container">
            <a class="navbar-brand text-light fw-bold d-flex align-items-center" href="#">
                <i class="bi bi-box me-2"></i> ShopEase
            </a>
            <button class="navbar-toggler bg-light" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarContent">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarContent">
                <ul class="navbar-nav mx-auto text-center mb-2 mb-lg-0">
                    <li class="nav-item"><a class="nav-link text-light active" href="/">Home</a></li>
                    <li class="nav-item"><a class="nav-link text-light" href="#">Contact</a></li>
                    <li class="nav-item"><a class="nav-link text-light" href="#">About Us</a></li>
                    <li class="nav-item"><a class="nav-link text-light" href="/allProducts">Shop List</a></li>
                </ul>

                <div class="d-lg-flex flex-column flex-lg-row align-items-center gap-5">
                    <div class="d-flex align-items-center justify-content-center gap-5 mt-lg-0 mt-3 mb-3 mb-lg-1">
                        <a href="/wishlist" class="text-light"><i class="bi bi-heart"></i></a>
                        <a href="/cart" class="text-light"><i class="bi bi-cart3"></i></a>
                        <a href="/profile" class="text-light"><i class="bi bi-person-circle"></i></a>
                    </div>
                    <div class="d-flex justify-content-center">
                        <a href="/logout" class="btn btn-outline-light">Logout</a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- ==================== USER QUICK LINKS (horizontal on large screens) ==================== -->
    <%- include("../partials/user/userQuickLinks.ejs") %>

    <!-- ==================== MAIN CONTENT (this grows and pushes footer down) ==================== -->
     <% let addressIndex %>
     <% let addressSelected = false %>
    <% if(cart?.length > 0){ %>
        
        <div class="main-content">
            <div class="container py-5">
                <div class="row">
                    <!-- Cart Items -->
                    <div class="col-lg-8">
                        <div class="bg-white rounded-3 shadow-sm" id="productTable">
                            <div class="table-responsive">
                                <table class="table table-borderless align-middle mb-0">
                                    <thead class="text-muted border-bottom">
                                        <tr>
                                            <th>Product</th>
                                            <th>Variant</th>
                                            <th>Price</th>
                                            <th>Quantity</th>
                                            <th>Subtotal</th>
                                            <th></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <% let totalPrice = 0 %>
                                        <% if(cart?.length > 0){ %>
                                            <% cart.forEach((ele, index) => { %>
                                                <tr class="cart-item" id="tableRow-<%= index %>">
                                                    <td>
                                                        <div class="d-flex align-items-center">
                                                            <img src="/<%= ele.image %>"
                                                                alt="<%= ele.product.name %>" class="rounded-3 me-3" width="80">
                                                            <div>
                                                                <h6 class="mb-0"><%= ele.product.name %></h6>
                                                            </div>
                                                        </div>
                                                    </td>
                                                    <td class="text-muted"><%= ele.variant.ram %> | <%= ele.variant.storage %> | <%= ele.variant.color %></td>
                                                    
                                                    <% 
                                                        let price = Number(ele.variant.price); 
                                                        let discount = Number(ele.discount); 
                                                        let offAmount = price * (discount / 100); 
                                                        let finalPrice = Math.floor(price - offAmount);
                                                    %>
                                                    
                                                    <td>&#8377;<%= finalPrice %></td>
                                                    <td>
                                                        <div class="d-flex align-items-center input-group">
                                                            <div class="quantity-btn input-group-text bg-dark text-light"
                                                                onclick='updateQuantity(this, -1, "<%= index %>", "<%= ele._id %>", "<%= finalPrice %>", "<%= ele.variant.quantity %>")'>-</div>
                                                                <div class="" style="width: 40px;">
                                                                    <input type="text" id="quantity-<%= index %>" class="quantity-input mx-0 form-control text-center px-0 py-2"  value="<%= ele.items.quantity %>" readonly>
            
                                                                </div>
                                                            <div class="quantity-btn  input-group-text bg-dark text-light"
                                                                onclick='updateQuantity(this, 1, "<%= index %>", "<%= ele._id %>", "<%= finalPrice %>", "<%= ele.variant.quantity %>")'>+</div>
                                                        </div>
                                                    </td>

                                                    <% 
                                                        
                                                        let subTotal = finalPrice * ele.items.quantity
                                                        totalPrice+=subTotal

                                                    %>

                                                    <td class="subtotal-price" id="subTotal-<%= index %>">&#8377; <%= subTotal %></td>
                                                    <td><i class="bi bi-trash3 text-muted cursor-pointer" onclick='removeProduct("<%= index %>", "<%= ele._id %>")'></i></td>
                                                </tr>                                        
                                            <% }) %>
                                        <% } %>   

                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-3 shadow-sm p-4 d-none" id="editAddress" style="top: 1rem; z-index: 8;">
                            <h5 class="mb-4">Edit address</h5>
                            <% if(address?.billingAddress?.length > 0){ %>
                                <% address.billingAddress.forEach((ele, index) => { %>
                                    <% if(ele.isSelected==true){ %>
                                        <% addressIndex = index %>
                                        <div>
                                            <div class="row g-3">
                                                <div class="col-12 col-lg-6">
                                                    <label class="form-label">Full name</label>
                                                    <input type="text" id="fullname" class="form-control" value="<%= address?.billingAddress[index].fullname %>">
                                                    <p class="text-danger" id="fullnameMsg" style="font-size: small; max-width: 320px;"></p>
                                                </div>

                                                <div class="col-12 col-lg-6">
                                                    <label class="form-label">phone number</label>
                                                    <input type="number" min="0" id="phone" class="form-control" value="<%= address?.billingAddress[index].phone %>">
                                                    <p class="text-danger" id="phoneMsg" style="font-size: small; max-width: 320px;"></p>
                                                </div>

                                                <div class="col-12 col-lg-6">
                                                    <label class="form-label">Email address</label>
                                                    <input type="text" id="email" class="form-control" value="<%= address?.billingAddress[index].email %>">
                                                    <p class="text-danger" id="emailMsg" style="font-size: small; max-width: 320px;"></p>
                                                </div>

                                                <div class="col-12 col-lg-6">
                                                    <label class="form-label">Pincode</label>
                                                    <input type="number" min="0" id="pincode" class="form-control" value="<%= address?.billingAddress[index].pincode %>">
                                                    <p class="text-danger" id="pincodeMsg" style="font-size: small; max-width: 320px;"></p>
                                                </div>

                                                <div class="col-12">
                                                    <label class="form-label">Address</label>
                                                    <textarea type="text" id="address" class="form-control"
                                                    ><%= address?.billingAddress[index].address %></textarea>
                                                    <p class="text-danger" id="addressMsg" style="font-size: small; max-width: 320px;"></p>
                                                </div>

                                                <div class="col-12 d-flex gap-2">
                                                    <div>
                                                        <label class="form-label" for="home">Home</label>
                                                        <input type="radio" id="home" class="radioBtn" name="addressType" value="Home"
                                                            checked>
                                                    </div>
                                                    <div>
                                                        <label class="form-label" for="work">Work</label>
                                                        <input type="radio" id="work" class="radioBtn" name="addressType" value="Work">
                                                    </div>
                                                </div>


                                                <div class="col-12">
                                                    <button class="btn btn-dark" id="submitBtn" onclick='confirmEdit("<%= index %>")'>Edit address</button>
                                                    <button class="btn btn-primary" id="submitBtn"  onclick='cancelEdit()'>Cancel edit</button>
                                                </div>
                                            </div>
                                        </div>
                                    <% } %>  
                                <% }) %>                                
                            <% } %>

                        </div>
                    </div>

                    <!-- Summary -->
                    <div class="col-lg-4 mt-4 mt-lg-0">
                        
                        <!-- address -->
                        <div class="bg-white rounded-3 shadow-sm p-4  style="top: 1rem; z-index: 8;">
                            <h5 class="mb-4">Billing address</h5>
                            
                            <% if(address?.billingAddress?.length > 0){ %>
                                <% address.billingAddress.forEach((ele, index) => { %>
                                    <% if(ele.isSelected==true){ %>
                                        <% addressSelected = true %>
                                        <% addressIndex = index %>
                                        <div>
                                            <h1 class="fs-6"><span class="fw-bold me-3">Name: </span><%= ele.fullname %></h1>
                                            <h1 class="fs-6"><span class="fw-bold me-3">Email: </span><%= ele.email %></h1>
                                            <h1 class="fs-6"><span class="fw-bold me-3">Phone: </span><%= ele.phone %></h1>
                                            <h1 class="fs-6 fw-light"><span class="fw-bold me-3">Address: </span><%= ele.address %></h1>
                                            <h1 class="fs-6"><span class="fw-bold me-3">Pincode: </span><%= ele.pincode %></h1>
                                            <h1 class="fs-6"><span class="fw-bold me-3">Type: </span><%= ele.addressType %></h1>
                                        </div>
                                        <div class="row  justify-content-center gap-2">
                                            <button class="btn btn-dark mt-3 col-8 col-md-5" onclick="location.href='/address'" >Change</button>
                                            <button class="btn btn-primary mt-3 col-8 col-md-5" onclick='editAddress("<%= index %>")' >Edit</button>
                                        </div>
                                        
                                    <% } %>  
                                <% }) %>                                
                            <% } %>
                            <% if(!addressSelected){ %>
                                    <button class="btn btn-dark mt-3" onclick="location.href='/address'" >Select address</button>
                            <% } %>
                        </div>

                        <!-- order summay -->

                        <div class="bg-white rounded-3 shadow-sm p-4  mt-2"" style="top: 1rem; z-index: 10;">
                            <h5 class="mb-3" id="itemCount">Coupon code</h5>
                            <div class="input-group">
                                <input type="text" class="form-control" name="coupon" id="coupon" placeholder="Coupon code" disabled>
                                <button class="btn btn-dark input-text" >Apply</button>

                            </div>
                            <hr>
                            <h5 class="mb-3" id="itemCount">Payment Methods</h5>
                            <ul  style="list-style-type: none;">
                                <li>
                                    <input type="radio" class="paymentMethod" name="paymentMethod" id="cod" checked>
                                    <label for="cod" class="fs-6">Cash on delivery</label>
                                </li>
                                <li>
                                    <input type="radio" class="paymentMethod" name="payment" id="wallet" disabled>
                                    <label for="wallet" class="fs-6">Wallet</label>
                                </li>
                                <li>
                                    <input type="radio" class="paymentMethod" name="payment" id="upi" disabled>
                                    <label for="upi" class="fs-6">UPI</label>
                                </li>
                            </ul>
                            <hr>
                            <h5 class="mb-3" id="itemCount">Price (<%= cart?.length %> items)</h5>
                            <div class="d-flex justify-content-between mb-2">
                               <span>Sub total:</span>
                               <span id="totalPrice" class="total-price">&#8377; <%= totalPrice %>.00</span>
                           </div>
                            <div class="d-flex justify-content-between mb-2">
                                <% let couponDiscount = 0 %>
                                <span>Coupon discount:</span>
                                <span id="couponDiscount" class="total-price">&#8377; <%= couponDiscount %>.00</span>
                            </div>
                            <div class="d-flex justify-content-between mb-2">
                                <span>Shipping charge:</span>
                                <span id="shippingCharge" class="total-price">&#8377; 50.00</span>
                            </div>
                            <div class="d-flex justify-content-between mt-3">
                                <span class="fw-bold">Total Amount:</span>
                                <span id="finalPrice" class="total-price text-success fw-bold">&#8377; <%= totalPrice - couponDiscount + 50 %>.00</span>
                            </div>

                            <button class="btn btn-proceed text-white w-100 mt-3" onclick='placeOrder()'>
                                Place order
                            </button>
                        </div>
                        
                    </div>
                </div>
            </div>
        </div>
    <% } else { %>
        <div class="main-content d-flex align-items-center justify-content-center px-5 pb-5 pt-0" style="min-height: 60vh;">
            <div class="text-center">
                <!-- Empty Cart Illustration (optional - you can replace with your own image) -->
                <div class="mb-4">
                    <i class="bi bi-cart3" style="font-size: 5rem; color: #ccc;"></i>
                </div>
                
                <h3 class="mb-3 text-muted">Your cart is empty</h3>
                <p class="text-muted mb-4">Looks like you haven't added anything to your cart yet.</p>
                
                <!-- Shop Now Button -->
                <a href="/allProducts" class="btn btn-proceed text-white px-5 py-3" style="font-size: 1.1rem;">
                    <i class="bi bi-bag-plus me-2"></i> Shop Now
                </a>
            </div>
        </div>
    <% } %>

    <!-- ==================== FOOTER (always at the bottom) ==================== -->
    <footer class="bg-dark text-white text-center py-3 mt-auto">
        <p class="mb-0">Â© 2025 ShopEase. All rights reserved.</p>
    </footer>

    <!-- Scripts -->
     <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        window.addEventListener("unload", function () {});

        const addressId = "<%= address?._id%>"
        const cartId = "<%= cart[0]?._id %>"
        

        async function updateQuantity(btn, change, index, cartId, price, quantity) {
            const input = btn.parentElement.querySelector('.quantity-input');

            if(input.value==1 && change==-1){
                swal.fire({
                    icon: "warning",
                    title: "Warning",
                    text: "Quantity can't be less then one"
                })
                return
            }            
            else if(input.value==5 && change==1){
                swal.fire({
                    icon: "warning",
                    title: "Warning",
                    text: "Quantity can't be more then five"
                })
                return
            }
            else if(input.value==quantity && change==1){
                swal.fire({
                    icon: "warning",
                    title: "Warning",
                    text: "Max quantity of the product reached"
                })
                return
            }


            try{
                const request = await fetch('/updateQuantity', {
                    method: "PATCH",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ change, index, cartId })
                })
                if(request.status==200){
                    const input = btn.parentElement.querySelector('.quantity-input');
                    let value = parseInt(input.value);
                    value = Math.max(1, value + change);
                    input.value = value;

                    document.getElementById(`subTotal-${index}`).innerHTML = `&#8377; ${value*price}`

                    const total = document.querySelectorAll('.subtotal-price')
                    let res=0
                    total.forEach(ele => {
                        res+=Number(ele.innerHTML.slice(1))
                    })
                    
                    document.getElementById("totalPrice").innerHTML = `&#8377; ${res}`
                    
                }
            }
            catch(err){
                alert("update quantity error")
                console.log(err)
            }

        }

        let removeIndex, removeCartId
        async function removeProduct(index, cartId){
            removeIndex = index
            removeCartId = cartId
            
            swal.fire({
                icon: "question",
                title: "Are you sure?",
                showCancelButton: true,
                confirmButtonText: "confirm",
            })
            .then(async (result) => {
                if (result.isConfirmed) {
                    try{
                        const request = await fetch('/removeProduct', {
                            method: "PATCH",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify({index, cartId})
                        })
                        if(request.status==200){                            
                            window.location.reload()                            
                        }
                    }   
                    catch(err){
                        alert("remove from cart error")
                        console.log(err)
                    }
                }
            })
            
        }
        
        async function editAddress(index) {
            try{
                document.getElementById("productTable").classList.add("d-none")
                document.getElementById("editAddress").classList.remove("d-none")

                window.location.href = "#editAddress"
                // window.location.href = `/editAddress/${index}/${addressId}`
            }
            catch(err){
                alert("edit address error")
                console.log(err)
            }
    }

        async function confirmEdit(index) {
            const fullnameRegex = /^(?=.{2,}$)(?!\s+$)[A-Za-z]+(?:[ '.][A-Za-z]+)*$/
            const phoneRegex = /^(?!\s+$)\d{7,15}$/
            const emailRegex = /^(?!\s+$)[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$/
            const pincodeRegex = /^(?!\s+$)\d{6}$/
            const addressRegex = /^(?!\s*$).{5,}$/

            const fullnameMsg = document.getElementById("fullnameMsg")
            const phoneMsg = document.getElementById("phoneMsg")
            const emailMsg = document.getElementById("emailMsg")
            const pincodeMsg = document.getElementById("pincodeMsg")
            const addressMsg = document.getElementById("addressMsg")

            const fullname = document.getElementById("fullname")
                const phone = document.getElementById("phone")
                const email = document.getElementById("email")
                const pincode = document.getElementById("pincode")
                const address = document.getElementById("address")
                const addressType = document.querySelector('input[name="addressType"]:checked')

                if (!fullnameRegex.test(fullname.value) && !phoneRegex.test(phone.value) && !emailRegex.test(email.value) && !pincodeRegex.test(pincode.value) && !addressRegex.test(address.value)) {
                    fullnameMsg.textContent = "enter your full name using letters only (no numbers or special symbols)"
                    phoneMsg.textContent = "enter a valid phone number with 7 to 15 digits and no spaces or symbols."
                    emailMsg.textContent = "enter a valid email address (example: user@example.com)."
                    pincodeMsg.textContent = "enter a valid 6-digit pincode using numbers only"
                    addressMsg.textContent = "enter a valid address (at least 5 characters, not blank)."

                    return
                }
                else if (!fullnameRegex.test(fullname.value)) {
                    fullnameMsg.textContent = "enter your full name using letters only (no numbers or special symbols)"
                    phoneMsg.textContent = ""
                    emailMsg.textContent = ""
                    pincodeMsg.textContent = ""
                    addressMsg.textContent = ""

                    return
                }
                else if (!phoneRegex.test(phone.value)) {
                    fullnameMsg.textContent = ""
                    phoneMsg.textContent = "enter a valid phone number with 7 to 15 digits and no spaces or symbols."
                    emailMsg.textContent = ""
                    pincodeMsg.textContent = ""
                    addressMsg.textContent = ""

                    return
                }
                else if (!emailRegex.test(email.value)) {
                    fullnameMsg.textContent = ""
                    phoneMsg.textContent = ""
                    emailMsg.textContent = "enter a valid email address (example: user@example.com)."
                    pincodeMsg.textContent = ""
                    addressMsg.textContent = ""

                    return
                }
                else if (!pincodeRegex.test(pincode.value)) {
                    fullnameMsg.textContent = ""
                    phoneMsg.textContent = ""
                    emailMsg.textContent = ""
                    pincodeMsg.textContent = "enter a valid 6-digit pincode using numbers only"
                    addressMsg.textContent = ""

                    return
                }
                else if (!addressRegex.test(address.value)) {
                    fullnameMsg.textContent = ""
                    phoneMsg.textContent = ""
                    emailMsg.textContent = ""
                    pincodeMsg.textContent = ""
                    addressMsg.textContent = "enter a valid address (at least 5 characters, not blank)."

                    return
                }
                else {
                    fullnameMsg.textContent = ""
                    phoneMsg.textContent = ""
                    emailMsg.textContent = ""
                    pincodeMsg.textContent = ""
                    addressMsg.textContent = ""
                }

                let testing = "<%= addressIndex %>"
                let isSelected = "<%= address?.billingAddress[addressIndex]?.isSelected %>"
                

                try {
                    const request = await fetch('/editAddress', {
                        method: "PATCH",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({
                            fullname: fullname.value,
                            phone: phone.value,
                            email: email.value,
                            pincode: pincode.value,
                            address: address.value,
                            addressType: addressType.value,
                            addressId,
                            index,
                            isSelected
                        })
                    })
                    const data = await request.json()
                    if (request.status == 200) {
                        swal.fire({
                            icon: "success",
                            title: "Success",
                            text: "Successfully edited the address"
                        })
                        .then(() => window.location.reload())
                    }
                    else if(request.status==404){
                        console.log(data)
                        document.body.innerHTML = `${data.html}`
                    }

                }
                catch (err) {
                    alert("Edit address error")
                    console.log(err)
                }
        }

        function cancelEdit(){
            document.getElementById("productTable").classList.remove("d-none")
            document.getElementById("editAddress").classList.add("d-none")

            window.location.href = "#productTable"
        }
        
        async function placeOrder(){
            const totalPrice = Number(document.getElementById("totalPrice").textContent.slice(2))
            const finalPrice = Number(document.getElementById("finalPrice").textContent.slice(2))
            const couponDiscount = Number(document.getElementById("couponDiscount").textContent.slice(2))
            const paymentMethod = document.querySelector('input[name="paymentMethod"]:checked')

            let isSelected = <%= addressSelected %>;


            if(!isSelected){
                swal.fire({
                    icon: "error",
                    title: "Error",
                    text: "Select an address before placing order"
                    
                })
                return
            }

            // alert("working")
            try{
                const request = await fetch('/placeOrder', {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ addressId, cartId, totalPrice, finalPrice, couponDiscount, paymentMethod })
                })
                if(request.status==200){
                    window.location.href = "/orderSuccess"
                }
            }
            catch(err){
                alert('place order error')
                console.log(err)
            }
        }
    </script>
</body>

</html>